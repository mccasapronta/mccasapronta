
<!doctype html>
<html lang="pt">
<head>
  <!-- deploy-sig: android-fix-v5 2025-10-07 14:55:28Z -->

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pedido de Limpeza</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    .logo { height: 72px; width: auto; object-fit: contain; }
    @media (max-width: 640px) { .logo { height: 30px; } }
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; padding:16px; background:#f6f7f9; }
    .container { max-width: 900px; margin: 0 auto; }
    .card { background:#fff; border-radius:16px; padding:24px; box-shadow: 0 6px 24px rgba(0,0,0,0.06); margin-bottom: 16px; }
    h1 { font-size: 1.6rem; margin: 0 0 12px; }
    h2 { font-size: 1.2rem; margin-top: 16px; display:flex; align-items:center; gap:10px; }
    .category { border:1px solid #e6e8eb; border-radius:12px; padding:16px; background:#fafbfc; }
    .items { margin: 8px 0 0 28px; line-height: 1.7; color:#374151; }
    .hint { font-size: .9rem; color:#6b7280; margin-top:8px; }
    .footer { display:flex; gap:12px; flex-wrap: wrap; align-items:center; }
    .btn { background:#111827; color:white; border:none; padding:12px 16px; border-radius:10px; cursor:pointer; font-weight:600; }
    .summary { font-weight:600; }
    form { margin:0; }
    input[type="checkbox"] { width:18px; height:18px; }
    label.catlabel { display:flex; align-items:center; gap:10px; font-weight:600; }
  
/* --- Android horizontal scroll fix (scoped & minimal) --- */
:root { --vw-safe: 100%; }
* { box-sizing: border-box; }
html, body { max-width: 100%; overflow-x: clip; }
img, svg, canvas, video { max-width: 100%; height: auto; }
table { width: 100%; max-width: 100%; }
input, select, textarea, button { min-width: 0; }
.flex, .row, [class*="row"], [class*="cols"], [class*="columns"] > * { min-width: 0; }
.grid { grid-template-columns: repeat(auto-fit, minmax(0, 1fr)); }
[class*="container"] { width: 100%; max-width: 100%; }
[class*="card"] { overflow: hidden; }
.long-text, .code, pre { word-break: break-word; overflow-wrap: anywhere; }

@media (max-width: 768px) {
  .row, .flex { flex-direction: column; align-items: stretch; }
  .columns, [class*="columns"] { grid-template-columns: 1fr !important; }
}
/* --- end fix --- */

/* --- Mobile (<=768px) strict stacking & overflow guard --- */
@media (max-width: 768px) {
  html, body { max-width: 100%; overflow-x: clip !important; }
  .columns, [class*="columns"] { grid-template-columns: 1fr !important; }
  .row { flex-direction: column !important; align-items: stretch !important; }
  .container { padding-left: 0 !important; padding-right: 0 !important; }
  .input, select, textarea, button { min-width: 0 !important; width: 100% !important; }
  table { table-layout: fixed !important; width: 100% !important; }
  th, td { word-break: break-word; overflow-wrap: anywhere; }
}
/* Remove any stray full-viewport widths that cause overflow */
[class*="container"], [class*="card"], [class*="section"] { max-width: 100% !important; }
img, svg, canvas, video { max-width: 100% !important; height: auto !important; }
/* --- end strict fix --- */

/* --- Mobile-only layout fix for home header + overflow guard --- */
@media (max-width: 768px) {
  html, body { max-width: 100%; overflow-x: clip !important; }
  /* Only affect the top hero/card that uses inline display:flex */
  .card[style*="display:flex"] { 
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 10px !important;
  }
  .card[style*="display:flex"] .logo { 
    display: block; 
    margin-bottom: 4px;
  }
  .row { flex-direction: column !important; align-items: stretch !important; }
  .columns, [class*="columns"] { grid-template-columns: 1fr !important; }
  .input, select, textarea, button { min-width: 0 !important; width: 100% !important; }
  img, svg, canvas, video { max-width: 100% !important; height: auto !important; }
  table { table-layout: fixed !important; width: 100% !important; }
  th, td { word-break: break-word; overflow-wrap: anywhere; }
}
/* --- end mobile fix --- */

/* --- debug badge (safe to remove later) --- */
#deploy-badge { 
  position: fixed; right: 8px; bottom: 8px; 
  font: 700 12px/1 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: rgba(16,185,129,.95); color:#fff;
  padding: 6px 8px; border-radius: 999px; z-index: 99999;
  box-shadow: 0 2px 8px rgba(0,0,0,.15);
  user-select: none; -webkit-user-select: none;
}
@media (prefers-color-scheme: dark) {
  #deploy-badge { box-shadow: 0 2px 8px rgba(0,0,0,.45); }
}
/* --- end debug badge --- */

/* --- debug badge v7 (safe to remove later) --- */
#deploy-badge { 
  position: fixed; right: 8px; bottom: 8px; 
  font: 700 12px/1 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: rgba(59,130,246,.95); color:#fff;
  padding: 6px 8px; border-radius: 999px; z-index: 99999;
  box-shadow: 0 2px 8px rgba(0,0,0,.15);
  user-select: none; -webkit-user-select: none;
}
/* --- end debug badge --- */
</style>
</head>
<body>
  <div class="container"><div class="card" style="display:flex; align-items:center; gap:14px;">
      <img src="/static/logo.png" alt="A tua marca" class="logo" />
      <div>
        <h1>Faça o seu pedido de limpeza <small style="font-size:.9rem;color:#6b7280;">(v7)</small></h1>
        <p>Selecione o(s) tipo(s) de limpeza pretendidos. Cada tipo inclui automaticamente os itens listados.</p>
      </div>
    </div>

    <form action="/quote" method="post">
      {% for category, items in catalog.items() %}
      <div class="card category">
        <label class="catlabel">
          <input type="checkbox" name="categories" value="{{ category }}">
          {{ category }}
        </label>
        <ul class="items">
          {% for item in items %}
            <li>{{ item.label }}</li>
          {% endfor %}
        </ul>
        <p class="hint">Ao escolher "{{ category }}", todos estes serviços são incluídos no pedido.</p>
      </div>
      {% endfor %}

      <div class="card footer">
        <button class="btn" type="submit">Continuar</button>
        <span class="summary">Pode rever antes de enviar.</span>
      </div>

      <div class="card" style="border:1px dashed #cbd5e1; background:#f9fafb; margin-top:8px;">
        <h2 style="margin-top:0;">Limpeza de Condomínios</h2>
        <p class="muted" style="margin:6px 0 12px;">Serviço sujeito a envio de email. Selecione para preencher um formulário rápido.</p>
        <a class="btn" href="/condominio" style="display:inline-block; text-decoration:none;">Pedir orçamento por email <br>Só para Condomínios </a>
      </div>

     
    <p class="muted" id="gps-advice" style="margin:8px 0 0;color:#6b7280;">Dica: use "usar a minha localização GPS" apenas se estiver <strong>na morada onde pretende o serviço</strong>.</p>
</form>
  </div>

    <script>
      (function(){
        const form = document.querySelector('form[action="/quote"]');
        if(!form) return;
        // Create an error element to show validation message
        const errorEl = document.createElement('p');
        errorEl.className = 'muted';
        errorEl.style.cssText = 'margin:6px 0 0; color:#b91c1c;';
        errorEl.id = 'catError';
        errorEl.hidden = true;
        // place it just before the footer card if present
        const footer = form.querySelector('.card.footer');
        if (footer) form.insertBefore(errorEl, footer);
        // block submit if no category is selected
        form.addEventListener('submit', function(e){
          const anyChecked = !!form.querySelector('input[name="categories"]:checked');
          if (!anyChecked) {
            e.preventDefault();
            errorEl.textContent = 'Selecione pelo menos um tipo de limpeza para continuar.';
            errorEl.hidden = false;
            errorEl.scrollIntoView({behavior:'smooth', block:'nearest'});
          }
        });
      })();
    </script>
    

<script>
(function gpsConfirmHook(){
  try {
    const btn = Array.from(document.querySelectorAll('button'))
      .find(b => /usar a minha localização/i.test(b.textContent));
    if (!btn) return;
    btn.addEventListener('click', function(e){
      const ok = confirm('Use esta opção apenas se estiver NA morada onde pretende o serviço. Continuar?');
      if (!ok) { e.preventDefault(); e.stopPropagation(); }
    }, {capture:true});
  } catch(_) {}
})();
</script>

<div id="deploy-badge" aria-hidden="true">v6</div>
<div id="deploy-badge" aria-hidden="true">v7</div>

<script>
function updateQuoteUI(data) {
  try {
    const fmt = (v) => Number(v || 0).toFixed(2) + " €";
    const setTxt = (sel, val) => { const el = document.querySelector(sel); if (el) el.textContent = val; };
    if (data && data.ok) {
      setTxt("#travel_cost", fmt(data.travel_cost));
      setTxt("#service_cost", fmt(data.service_cost));
      setTxt("#total_cost", fmt(data.total));
      const dbg = document.querySelector("#debug_line");
      if (dbg && data.breakdown) {
        dbg.textContent = `Dist: ${data.distance_km} km • €/km: ${data.breakdown.travel_rate}`;
      }
    }
  } catch (e) { console && console.error && console.error(e); }
}
</script>

</body>
</html>
